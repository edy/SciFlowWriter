 <!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>	  <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>	  <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<title>SciFlowWriter</title>
		<meta name="description" content="">
		<link rel="stylesheet/less" type="text/css" href="/static/plugins/ep_sciflowwriter/static/css/profile.css">
		<script src="/static/plugins/ep_sciflowwriter/static/js/less-1.3.0.min.js" type="text/javascript"></script>
		<!--link rel="stylesheet" href="style.css"-->
	</head>
	<body>
		
		<header>
			<div class="container">
				<h1>SciFlowWriter</h1>
				<div class="headermenu">
					<a href="/"></a>
				</div>
			</div>
		</header>
		<div class="container">
			<div class="contentContainer">
				<aside>
					<div id="avatar"></div>
					<div class="padmenu">
						<ul>
							<!--li>
								<a href="#allpads">All Pads</a>
							</li-->
							<li class="active">
								<a href="#mypads">My Pads</a>
							</li>
							<li>
								<a href="#otherpads">Other Pads</a>
							</li>
						</ul>
					</div>
				</aside>
				<div id="right">
					<div id="personalInformation">
						<h2 id="name"></h2>
						<p id="email"></p>
						<div id="editProfile">
							<button class="button green">Edit</button>
						</div>
					</div>
					<div id="content">
						<div id="mypads">
							<h3>My Pads</h3>
							<!--input type="search" name="s" results="5"-->
							<p><a id="newpad" href="#">new pad</a></p>
							<table>
								<thead>
									<tr>
										<td>
											Title
										</td>
										<td>
											Last Changed On
										</td>
										<td>
											&nbsp;
										</td>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
						<div id="otherpads" style="display:none">
							<h3>Other Pads</h3>
							<!--input type="search" name="s" results="5"-->
							<table>
								<thead>
									<tr>
										<td>
											Title
										</td>
										<td>
											Last Changed On
										</td>
										<td>
											&nbsp;
										</td>
									</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
					</div>
				</div>
				<div id="headline"></div>
				<div class="clearfix"></div>
			</div>
		</div>

		<script src="/static/js/jquery.js"></script>
		<script type="text/javascript">
		$(function(){
			$.getJSON('/profile', function(data) {
				
				$('#avatar').append('<img src="'+data.image+'" />');
				$('#name').append(data.name);
				$('#email').append(data.email);
				$('.headermenu a').append(data.name+' <img src="'+data.image+'" />')

				$.each(data.pads.my, function(i, v) {
					Profile.addPad('my', v);
				});

				$.each(data.pads.other, function(i, v) {
					Profile.addPad('other', v);
				});

				$.each(data.pads.review, function(i, v) {
					Profile.addPad('review', v);
				});

			});

			$('.padmenu li a').on('click', function(e) {
				var show = $(this).attr('href');
				$('#mypads,#otherpads').hide();
				$(show).show();
				$('.padmenu li').removeClass('active')
				$(this).parent().addClass('active');
				return false;
			});

			$('#newpad').on('click', function(e){
				var name = prompt('Please name your pad:', 'my cool pad');
				
				if (name !== null) {
					$.getJSON('/profile/newpad?name='+name, function(data){
						Profile.addPad('my', data.padID, data.uri);
					});
				}

				return false;
			});

			$('.invitelink').live('click', function(e) {
				var email = prompt('Send invite mail to:', '');
				//console.log(this);
				if (email !== null) {
					$.getJSON(this.href, {'email':email}, function(data){
						alert('Sent email with link: '+data.url)
					});
				}

				return false;
			});
		});

 		var Profile = {
 			addPad : function(type, name, uri) {
 				uri = uri || '/p/'+name;
 				
 				$('#'+type+'pads table tbody').append('<tr><td><a href="'+uri+'">'+name+'</a></td><td>&nbsp;</td><td><a class="invitelink" href="/profile/invite?name='+name+'">invite</a></td></tr>');
 			}
 		}
		</script>
	</body>
</html>